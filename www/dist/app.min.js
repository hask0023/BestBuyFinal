/*! Final App - v1.0.0 - 2015-12-16
* Copyright (c) 2015 Steve Haskins; Licensed  */
angular.module("starter",["ionic","starter.controllers","ngCordova","LocalStorageModule","starter.storecontroller","starter.storeservice","starter.searchservice","starter.searchcontroller","starter.logscontroller","starter.logsservice","angular-logger","starter.exceptionOverride","satellizer"]).run(function(a){a.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault()})}).config(function(a,b,c,d){a.state("app",{url:"/app","abstract":!0,templateUrl:"templates/menu.html",controller:"AppCtrl"}).state("app.search",{url:"/search",views:{menuContent:{templateUrl:"templates/search.html",controller:"SearchCtrl"}}}).state("app.logs",{url:"/logs",views:{menuContent:{templateUrl:"templates/logs.html",controller:"LogsCtrl"}}}).state("app.stores",{url:"/stores",views:{menuContent:{templateUrl:"templates/stores.html",controller:"StoreCtrl"}}}),b.otherwise("/app/search"),c.datetimePattern="HH:mm:ss",c.prefixPattern="%s %s: ",d.facebook({clientId:"771402229636026",responseType:"token"})}),angular.module("starter.controllers",[]).controller("AppCtrl",function(a,b,c,d,e,f,g,h){var i;a.loginData={},a.loggedIn=!1,a.currentUser="",b.fromTemplateUrl("templates/login.html",{scope:a,backdropClickToClose:!1,hardwareBackButtonClose:!1}).then(function(b){a.modal=b,a.modal.show()}),a.closeLogin=function(){a.modal.hide()},a.login=function(){a.modal.show(),a.loggedIn=!1,e.logout(),d.logError(g.debug("Logged out successfully"))},a.doLogin=function(){console.log("Doing login",a.loginData),a.loginData.password&&a.loginData.username?"guest"===a.loginData.username?h.alert({title:"Error",content:"Invalid Username"}):a.loginData.password.length<5?h.alert({title:"Error",content:"Password too short. Must be at least 5 characters."}):(i=a.loginData.username,console.log(a.loginData.password.length),a.modal.hide(),a.currentUser=i,a.loggedIn=!0,d.logError(g.debug("Logged in successfully"))):h.alert({title:"Error",content:"You must enter a username and password."})},a.isAuthenticated=function(){return e.isAuthenticated()},a.authenticate=function(b){e.authenticate(b).then(function(b){console.log(JSON.stringify(b)),a.loggedIn=!0,d.logError(g.debug("Logged in successfully")),a.modal.hide();var c=["id","email","first_name","last_name","link","name"],e="https://graph.facebook.com/v2.5/me?fields="+c.join(",");f.get(e).then(function(b){a.currentUser=b.data.first_name+" "+b.data.last_name})})["catch"](function(a){d.logError(g.debug(a))})},a.logout=function(){e.logout(),a.loggedIn=!1}}),angular.module("starter.exceptionOverride",[]).factory("exceptionOverride",["$exceptionHandler",function(a){return function(b,c){var d=a.get("errors")||[];b.message+=' (caused by "'+c+'" )',d.push({error:b}),a.set("errors",d)}}]),angular.module("starter.logscontroller",[]).controller("LogsCtrl",function(a,b){a.$on("$ionicView.enter",function(){var c=b.get("errors");a.errors=c}),a.clearLogs=function(){b.clearAll(),a.errors=b.get("errors")}}),angular.module("starter.logsservice",[]).factory("logsSrv",["localStorageService",function(a){var b=a.get("errors")||[];return{logError:function(c){return b.push({error:c}),a.set("errors",b),"Error added"}}}]),angular.module("starter.searchcontroller",[]).controller("SearchCtrl",function(a,b,c,d,e,f){a.searchNow=function(){a.products=null,a.searchName&&(a.noResults=!1,d.searchItems(a.searchName).then(function(b){b.length<1?(a.noResults=!0,e.logError(f.debug("You searched something weird didn't ya."))):a.products=b}))}}),angular.module("starter.searchservice",[]).factory("searchSrv",["$http",function(a,b,c){var d="3kjmw8ybzsfxhfenh6nnujud";return{searchItems:function(e){var f=e.split(" "),g=f[0],h="",i="";f.length>1&&(h="&search="+f[1]),f.length>2&&(i="&search="+f[2]);var j=a.get("http://api.bestbuy.com/v1/products((search="+g+h+i+"))?show=name,sku,salePrice,image&format=json&apiKey="+d).then(function(a){console.log("Success",a);var b=a.data.products;return b},function(a){return console.error("ERR",a),b.logError(c.debug(a)),{status:!1}});return j}}}]),angular.module("starter.storecontroller",[]).controller("StoreCtrl",function(a,b,c,d,e,f,g){var h,i={timeout:1e4,enableHighAccuracy:!1};e.getCurrentPosition(i).then(function(b){var c=b.coords.latitude,e=b.coords.longitude;d.getNearbyStores(c,e).then(function(b){a.storeListGeo=b,h=a.storeListGeo,0===a.storeListGeo.length&&(a.noResults=!0)})},function(a){f.logError(g.debug(a))}),a.searchCity=function(){a.cityName&&(a.storeListGeo=null,a.noResults=!1,d.getCityStores(a.cityName).then(function(b){a.storeListCity=b,0===a.storeListCity.length&&(a.noResults=!0)}))},a.findNearbyStores=function(){a.noResults=!1,a.storeListCity=null,a.storeListGeo=h}}),angular.module("starter.storeservice",[]).factory("storeSrv",["$http",function(a,b,c){var d="3kjmw8ybzsfxhfenh6nnujud";return{getNearbyStores:function(e,f){var g=a.get("http://api.bestbuy.com/v1/stores(area("+e+","+f+",1000))?show=name,address,hoursAmPm,phone,distance&format=json&apiKey="+d).then(function(a){console.log("Success",a),console.log(a.data);var b=a.data.stores;return b},function(a){return b.logError(c.debug(a)),console.error("ERR",a),{status:!1}});return g},getCityStores:function(e){var f=a.get("http://api.bestbuy.com/v1/stores(city="+e+")?show=name,address,hoursAmPm,phone,distance&format=json&apiKey="+d).then(function(a){console.log("Success",a);var b=a.data.stores;return b},function(a){return b.logError(c.debug(a)),console.error("ERR",a),{status:!1}});return f}}}]);