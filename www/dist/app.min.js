angular.module("starter",["ionic","starter.controllers","ngCordova","LocalStorageModule","starter.storecontroller","starter.storeservice","starter.searchservice","starter.searchcontroller","starter.logscontroller","starter.logsservice","angular-logger","starter.exceptionOverride","satellizer"]).run(function(a){a.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault()})}).config(function(a,b,c,d){a.state("app",{url:"/app","abstract":!0,templateUrl:"templates/menu.html",controller:"AppCtrl"}).state("app.search",{url:"/search",views:{menuContent:{templateUrl:"templates/search.html",controller:"SearchCtrl"}}}).state("app.logs",{url:"/logs",views:{menuContent:{templateUrl:"templates/logs.html",controller:"LogsCtrl"}}}).state("app.stores",{url:"/stores",views:{menuContent:{templateUrl:"templates/stores.html",controller:"StoreCtrl"}}}),b.otherwise("/app/search"),c.datetimePattern="HH:mm:ss",c.prefixPattern="%s %s: ",d.facebook({clientId:"771402229636026",responseType:"token"})}),angular.module("starter.controllers",[]).controller("AppCtrl",function(a,b,c,d,e,f,g,h){var i;a.loginData={},a.loggedIn=!1,a.currentUser="",b.fromTemplateUrl("templates/login.html",{scope:a,backdropClickToClose:!1,hardwareBackButtonClose:!1}).then(function(b){a.modal=b,a.modal.show()}),a.closeLogin=function(){a.modal.hide()},a.login=function(){a.modal.show(),a.loggedIn=!1,f.logout()},a.doLogin=function(){console.log("Doing login",a.loginData),a.loginData.password&&a.loginData.username?"guest"===a.loginData.username?alert("Invalid username."):a.loginData.password.length<5?alert("Password too short. Must be at least 5 characters."):(i=a.loginData.username,console.log(a.loginData.password.length),a.modal.hide(),a.currentUser=i,a.loggedIn=!0):alert("You must enter a username and password")},a.isAuthenticated=function(){return f.isAuthenticated()},a.authenticate=function(b){f.authenticate(b).then(function(b){a.loggedIn=!0,a.modal.hide();var c=["id","email","first_name","last_name","link","name"],d="https://graph.facebook.com/v2.5/me?fields="+c.join(",");g.get(d).then(function(b){a.currentUser=b.data.first_name+" "+b.data.last_name})})["catch"](function(a){d.logError(h.debug(a))})},a.logout=function(){f.logout(),a.loggedIn=!1,f.isAuthenticated()&&console.log("it is not logged out"),f.isAuthenticated()||d.logError(h.debug("logged out successfully"))}}),angular.module("starter.exceptionOverride",[]).factory("exceptionOverride",["$exceptionHandler",function(a){return function(b,c){a.get("errors")||[];throw b.message+=' (caused by "'+c+'" )',b}}]),angular.module("starter.logscontroller",[]).controller("LogsCtrl",function(a,b,c,d,e){a.$on("$ionicView.enter",function(c){var d=b.get("errors");a.errors=d}),a.clearLogs=function(){b.clearAll(),a.errors=b.get("errors")}}),angular.module("starter.logsservice",[]).factory("logsSrv",["localStorageService","$log","$exceptionHandler",function(a,b,c){var d=a.get("errors")||[];return{logError:function(b){return d.push({error:b}),a.set("errors",d),"Error added"}}}]),angular.module("starter.searchcontroller",[]).controller("SearchCtrl",function(a,b,c,d,e,f,g){a.searchNow=function(){a.products=null,a.searchName&&(a.noResults=!1,d.searchItems(a.searchName).then(function(b){console.log(b.length),b.length<1?(a.noResults=!0,e.logError(f.debug("You searched something weird didn't ya."))):a.products=b}))}}),angular.module("starter.searchservice",[]).factory("searchSrv",["$http","$cordovaGeolocation",function(a,b,c){var d="3kjmw8ybzsfxhfenh6nnujud";return{searchItems:function(b){var c=b.split(" "),e=c[0],f="",g="";c.length>1&&(f="&search="+c[1]),c.length>2&&(g="&search="+c[2]);var h=a.get("http://api.bestbuy.com/v1/products((search="+e+f+g+"))?show=name,sku,salePrice,image&format=json&apiKey="+d).then(function(a){console.log("Success",a);var b=(angular.fromJson(a),a.data.products);return b},function(a){return console.error("ERR",a),{status:!1}});return h}}}]),angular.module("starter.storecontroller",[]).controller("StoreCtrl",function(a,b,c,d,e,f,g){var h,i={timeout:1e4,enableHighAccuracy:!1};e.getCurrentPosition(i).then(function(b){var c=b.coords.latitude,e=b.coords.longitude;d.getNearbyStores(c,e).then(function(b){a.storeListGeo=b,h=a.storeListGeo,0===a.storeListGeo.length&&(a.noResults=!0)})},function(a){f.logError(g.debug(a))}),a.searchCity=function(){a.cityName&&(a.storeListGeo=null,a.noResults=!1,d.getCityStores(a.cityName).then(function(b){a.storeListCity=b,0===a.storeListCity.length&&(a.noResults=!0)}))},a.findNearbyStores=function(){a.noResults=!1,a.storeListCity=null,a.storeListGeo=h}}),angular.module("starter.storeservice",[]).factory("storeSrv",["$http","$cordovaGeolocation",function(a,b){var c="3kjmw8ybzsfxhfenh6nnujud";return{getNearbyStores:function(b,d){var e=a.get("http://api.bestbuy.com/v1/stores(area("+b+","+d+",1000))?show=name,address,hoursAmPm,phone,distance&format=json&apiKey="+c).then(function(a){console.log("Success",a),console.log(a.data);var b=a.data.stores;return b},function(a){return logsSrv.logError($log.debug(a)),console.error("ERR",a),{status:!1}});return e},getCityStores:function(b){var d=a.get("http://api.bestbuy.com/v1/stores(city="+b+")?show=name,address,hoursAmPm,phone,distance&format=json&apiKey="+c).then(function(a){console.log("Success",a);var b=a.data.stores;return b},function(a){return logsSrv.logError($log.debug(a)),console.error("ERR",a),{status:!1}});return d}}}]);